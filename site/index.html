<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Team Digests</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css" />
<style>
  .pill{display:inline-block;border:1px solid #444;border-radius:999px;padding:.1rem .6rem;margin-left:.4rem;font-size:.85rem;opacity:.8}
  .row{display:flex;align-items:center;gap:.5rem}
  .muted{opacity:.7}
  .grid{display:grid;gap:.75rem}
  .latest{padding:.75rem;border:1px solid #333;border-radius:.75rem;background:#121212}
  .row a{white-space:nowrap}
  .toolbar{display:flex;gap:.5rem;flex-wrap:wrap}
</style>

<h1>Team Digests</h1>

<section class="latest" id="latestBox" hidden>
  <h2>Latest</h2>
  <div class="grid" id="latestList"></div>
</section>

<div class="toolbar">
  <input id="q" type="search" placeholder="Search filename (e.g., weekly_2025-10-06)" />
  <select id="cad">
    <option value="">All cadences</option>
    <option value="daily">Daily</option>
    <option value="weekly">Weekly</option>
    <option value="monthly">Monthly</option>
  </select>
  <a href="./feed.json" class="pill" target="_blank" rel="noopener">JSON feed</a>
  <a href="./feed.xml" class="pill" target="_blank" rel="noopener">RSS</a>
</div>

<ul id="list"></ul>

<script src="./digests.js"></script>
<script>
(function(){
  const digests = (window.digests||[]).slice(); // newest first
  const latest = (window.latest||{});
  const list = document.getElementById('list');
  const q = document.getElementById('q');
  const cad = document.getElementById('cad');

  function row(it){
    const li = document.createElement('li');
    li.className = 'row';
    li.innerHTML = `
      <a href="./viewer.html?file=${encodeURIComponent(it.file)}">${it.file}</a>
      <span class="muted">— ${it.date}</span>
      <span class="pill">${it.cadence}</span>
      <small>(<a href="./${encodeURIComponent(it.file)}">raw</a>)</small>`;
    return li;
  }

  function render(){
    const needle = q.value.trim().toLowerCase();
    const filterCad = cad.value;
    list.innerHTML = '';
    digests
      .filter(it => (!filterCad || it.cadence===filterCad))
      .filter(it => (!needle || it.file.toLowerCase().includes(needle)))
      .forEach(it => list.appendChild(row(it)));
  }

  // Latest section
  const latestBox = document.getElementById('latestBox');
  const latestList = document.getElementById('latestList');
  function renderLatest(){
    const picks = [];
    if (latest.overall) picks.push({label:"Newest", item:latest.overall});
    if (latest.byCadence && latest.byCadence.daily)   picks.push({label:"Daily",   item:latest.byCadence.daily});
    if (latest.byCadence && latest.byCadence.weekly)  picks.push({label:"Weekly",  item:latest.byCadence.weekly});
    if (latest.byCadence && latest.byCadence.monthly) picks.push({label:"Monthly", item:latest.byCadence.monthly});
    if (!picks.length) return;
    latestBox.hidden = false;
    picks.forEach(p => {
      const div = document.createElement('div');
      div.className = 'row';
      div.innerHTML = `
        <strong class="pill">${p.label}</strong>
        <a href="./viewer.html?file=${encodeURIComponent(p.item.file)}">${p.item.title || p.item.file}</a>
        <span class="muted">— ${p.item.cadence}, ${p.item.date}</span>
        <small>(<a href="./${encodeURIComponent(p.item.file)}">raw</a>)</small>`;
      latestList.appendChild(div);
    });
  }

  q.addEventListener('input', render);
  cad.addEventListener('change', render);

  renderLatest();
  render();
})();
</script>
