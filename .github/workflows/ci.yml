
name: CI

on:
  push:
  pull_request:

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: pip install --upgrade pip build
      - run: python -m build
      - name: Verify wheel has examples
        run: |
          python - <<'PY'
          import zipfile, glob
          w = sorted(glob.glob("dist/*.whl"))[-1]
          with zipfile.ZipFile(w) as z:
              names = z.namelist()
              assert any(n.startswith("team_digest/__init__.py") for n in names)
              assert any(n.startswith("team_digest/examples/") for n in names)
          print("âœ… wheel contains package + examples:", w)
          PY
      - name: Install from wheel & render sample
        run: |
          python -m venv .venv && source .venv/bin/activate
          pip install --no-cache-dir dist/*.whl
          python - <<'PY' > logs_path.txt
          import importlib.resources as r, team_digest
          print((r.files(team_digest) / "examples" / "logs").__fspath__())
          PY
          mkdir -p out
          team-digest --input "$(cat logs_path.txt)" --format md   --output out/digest.md
          team-digest --input "$(cat logs_path.txt)" --format json --output out/digest.json
          test -s out/digest.md && test -s out/digest.json
