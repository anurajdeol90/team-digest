name: Verify Packaged Examples

on:
  workflow_dispatch:

jobs:
  verify:
    runs-on: ubuntu-latest

    steps:
      - name: Check out
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install package from PyPI
        run: |
          python -m pip install -U pip
          pip install -U team-digest

      - name: Prepare OUTDIR and copy packaged example logs
        id: prep
        run: python scripts/ci_copy_examples.py

      - name: Show installed version
        run: |
          python -c "import importlib.metadata as m, team_digest; print('dist:', m.version('team-digest')); print('__version__:', team_digest.__version__)"

      - name: Build weekly/daily/monthly from packaged examples
        env:
          EXLOGS: ${{ steps.prep.outputs.exlogs }}
          OUTDIR: ${{ steps.prep.outputs.outdir }}
        run: python scripts/ci_build_digests.py

      - name: Upload digests artifact
        uses: actions/upload-artifact@v4
        with:
          name: verify-examples-digests
          path: ${{ steps.prep.outputs.outdir }}/*.md
          if-no-files-found: error
